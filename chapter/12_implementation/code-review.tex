\newpage
\chapter{Code Review} 

\section{20.04.16 - Review Prototyp Routing}
Folgende Code Änderungen wurden reviewed von KP und MS :
\begin{itemize}
	\item{Anbindung Hibernate Spatial}
	\item{Verwendung von SFCGAL: SFCGAL ist eine Libary, welches von PostGIS verwendet wird. Es musste geprüfut werden ob SFCGAL richtig installiert wurde.}
	\item{Helper Klasse für WKT und Polygon Verarbeitung}
\end{itemize}

Während dem Code Review wurden die folgenden Anpassungen gemacht:
\begin{itemize}
	\item{Fehlende Test hinzugefügt}
	\item{Kommentar hinzugefügt, wo Kontext nicht klar war}
	\begin{lstlisting}
	/**
     * SFCGAL is a library used by PostGis. It is not part of PostGis and must therefore
     * be installed separately. This tests verifies - that SFCGAL ist correctly installed.
     */
    public class AssertSfcgalInstallationTest extends AbstractIntegrationTest {
      //...
    }
	\end{lstlisting}
	\item{Methoden unbenannt nach Java Standard: WGS84Helper -> Wgs84Helper }
	\item{In manchen Test wurde WKT ( Well Known Text ) statt WKB ( Well Known Binary ) für Polygon verwendet. Beide Formate sind unlesbar, aber WKT bietet den Vorteil, dass es einfacher ersichtlich ist, um was für ein Art Polygon es sich handelt.}
	\begin{lstlisting}
    geometry = GisHelper.convertFromWkbToGeometry("0103000020E6100000010000000F000000FFBE7D4109A2214002A052D59E9E9C4740");
    // korrigiert zu
    String pointTypeString = "POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10))";
    Polygon pointType = (Polygon) GisHelper.convertFromWktToGeometry(pointTypeString);
	\end{lstlisting}
\end{itemize}
\newpage

\section{13.05.2016 - Review Message Handling \& Message Queue}
Folgende Code Änderungen wurden reviewed von MS und MA:
\begin{itemize}
	\item{Message Handling Server}
	\item{Server Message Persistance}
	\item{Message Handling Onboard app}
\end{itemize}
Während dem Code Review wurden die folgenden Anpassungen gemacht:
\begin{itemize}
	\item{Queue mit Exception implementierung verbessert:
	\begin{lstlisting}
    if (connection.isOpen()) {
        while (messagesToSend.peek() != null) {
            String messageToSend = messagesToSend.peek();
            channel.basicPublish("", ConnectionUtils.getDroneSideProducerQueueName(droneToken), null, messageToSend.getBytes());
            messagesToSend.remove();
        }
    }
	\end{lstlisting}
	An dieser Stelle wurde messagesToSend.get() durch peek() und remove() ersetzt, damit beim werfen der Exception, durch möglichen Verbindungsabbruch die Meldung nicht verloren geht.}
	\item{Entfernen von connectionClose() auf dem Server. Die Methode existiert bereits als Methode mit einer Verbindung im Funktionsaufruf, aus diesem Grund ist die Methode redundant und wird nicht benötigt.}
\end{itemize}
\section{03.06.2015 - Gesamt Code Review}

Dieses Code Review wurde von Mirco Stocker durchgeführt und betrifft den ganzen Server-Code sowie die Android Onboard-App.

\subsection{Onboard-App}

Die wichtigsten Findings betrafen potentielle Concurrency Probleme, sowie Unschönheiten in den Android-Lifecycle Methoden.

\subsubsection{Concurrency}

Beim Herstellen einer Verbindung mit dem Messagingserver wurde ein neuer Thread gestartet und dort die Variablen "connection" und "channel" zugewiesen. Dies könnte potentiell Probleme verursachen und die Variablen wurden deshalb mit volatile Ergänzt.

\subsubsection{Lifecycle}

In vielen Fragments und Activities wurde die OnDestroy Methode verwendet um Resourcen abzuräumen. Die Ausführung von OnDestroy ist aber nicht garantiert. Deshalb wurde der Code in die OnPause-Methode verschoben und wird nun garantiert ausgeführt, wenn die Activity oder das Fragment vom Betriebssystem beendet wird.

Einige Methoden die Handler registrieren wurden sowohl in den OnCreate-Methoden, wie auch in den  OnResume Methoden ausgeführt. Dies ist keine saubere Lösung. Dieser Code wird nun deshalb nurnoch im OnResume ausgeführt.

